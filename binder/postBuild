#!/bin/bash
set -ex

echo "Starting postBuild script..."

echo "Updating pip and installing wheel..."
pip install --upgrade pip wheel

echo "Installing an older, compatible version of notebook..."
pip install "notebook~=6.5.0" # Or another 6.x version

echo "Installing Python packages..."
pip install matplotlib
pip install ipywidgets
# pyqt5 is already installed via apt (python3-pyqt5.qtopengl)
# pip install pyqt5 # You might be able to remove this pip install if the apt version is sufficient
pip install MDAnalysis # Ensure this is the correct capitalization
pip install jupyter # Usually already present, but explicit install is okay
pip install mdtraj
pip install nglview
pip install jupyter_contrib_nbextensions # Install after notebook<7

echo "Installing IPython kernel..."
python -m ipykernel install --sys-prefix

echo "Installing and enabling Jupyter notebook extensions..."
jupyter contrib nbextension install --sys-prefix # This should now work

echo "Enabling core extensions..."
jupyter nbextension enable --py --sys-prefix widgetsnbextension
jupyter nbextension enable --py --sys-prefix nglview

echo "Enabling other contrib extensions..."
jupyter nbextension enable scratchpad/main
jupyter nbextension enable rubberband/main
jupyter nbextension enable exercise2/main
jupyter nbextension enable toggle_all_line_numbers/main
jupyter nbextension enable execute_time/ExecuteTime
jupyter nbextension enable latex_envs/latex_envs

echo "postBuild script finished successfully."
